<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CessationEngine Pro</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f172a">

<style>
:root{
--bg:#0f172a;
--card:#1e293b;
--accent:#0ea5e9;
--green:#10b981;
--yellow:#f59e0b;
--red:#ef4444;
--text:#f8fafc;
--muted:#94a3b8;
}

body{margin:0;font-family:system-ui;background:var(--bg);color:var(--text);padding:15px;}
.container{max-width:650px;margin:auto;}
.card{background:var(--card);padding:16px;border-radius:14px;margin-bottom:12px;}
h1{text-align:center;background:linear-gradient(45deg,var(--accent),var(--green));
-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
button{background:var(--accent);border:none;padding:12px;width:100%;
border-radius:8px;color:white;font-weight:bold;margin-top:8px;}
input,select{width:100%;padding:10px;margin-bottom:10px;background:#0b1220;
border:1px solid #334155;color:white;border-radius:6px;}
.badge{display:inline-block;padding:5px 10px;border:1px solid #475569;
border-radius:10px;font-size:12px;margin:3px;}
.unlocked{border-color:var(--yellow);color:var(--yellow);}
.hidden{display:none;}
.center{text-align:center;}
</style>
</head>
<body>

<div class="container">

<h1>CessationEngine Pro</h1>
<p class="center" id="rank">Rank: Rookie</p>

<div id="setup" class="card">
<input type="datetime-local" id="quitDate">
<input type="number" id="cigsDay" placeholder="Cigarettes per day">
<input type="number" id="packPrice" placeholder="Price per pack">
<button onclick="startJourney()">Start New Life</button>
</div>

<div id="dashboard" class="hidden">

<button style="background:var(--red);" onclick="startSurvival()">I HAVE A CRAVING</button>

<div class="card">
<p>Time Smoke-Free</p>
<h2 id="timer">0d 0h 0m 0s</h2>
<p id="status"></p>
</div>

<div class="card">
<p>Money Saved</p>
<h2 id="money">$0.00</h2>
<p id="yearProjection"></p>
</div>

<div class="card">
<p>Daily Emotional Check-In</p>
<select id="mood">
<option>Calm</option>
<option>Stressed</option>
<option>Bored</option>
<option>Angry</option>
<option>Social Pressure</option>
</select>
<button onclick="logMood()">Log Mood</button>
<p id="coachMessage"></p>
</div>

<div class="card">
<p>Craving Pattern Alert</p>
<p id="patternMsg"></p>
</div>

<div class="card">
<p>Achievements</p>
<div id="badges"></div>
</div>

<button style="background:#334155;" onclick="resetApp()">Reset</button>

</div>

<div id="survivalBox" class="card hidden">
<h3 class="center">Craving Survival Mode</h3>
<div id="survivalContent"></div>
</div>

</div>

<script>

if("serviceWorker" in navigator){
navigator.serviceWorker.register("pwabuildersw.js");
}

let stage=0;

function startJourney(){
const data={
quit:new Date(document.getElementById("quitDate").value).getTime(),
cigs:parseFloat(document.getElementById("cigsDay").value),
price:parseFloat(document.getElementById("packPrice").value)
};
if(!data.quit||!data.cigs||!data.price){alert("Fill all fields");return;}
localStorage.setItem("quitData",JSON.stringify(data));
document.getElementById("setup").classList.add("hidden");
document.getElementById("dashboard").classList.remove("hidden");
updateEngine();
setInterval(updateEngine,1000);
}

function updateEngine(){
const data=JSON.parse(localStorage.getItem("quitData"));
if(!data)return;
let diff=Date.now()-data.quit;
if(diff<0)return;
let d=Math.floor(diff/86400000);
let h=Math.floor(diff%86400000/3600000);
let m=Math.floor(diff%3600000/60000);
let s=Math.floor(diff%60000/1000);
document.getElementById("timer").innerText=`${d}d ${h}h ${m}m ${s}s`;
let avoided=(diff/86400000)*data.cigs;
let saved=(avoided/20)*data.price;
document.getElementById("money").innerText="$"+saved.toFixed(2);
let yearly=saved/(diff/86400000||1)*365;
document.getElementById("yearProjection").innerText="Projected 1yr: $"+yearly.toFixed(0);
updateRank(d);
updateBadges(d);
detectPattern();
}

function updateRank(d){
let r="Rookie";
if(d>=7)r="Warrior";
if(d>=30)r="Guardian";
if(d>=90)r="Legend";
document.getElementById("rank").innerText="Rank: "+r;
}

function updateBadges(d){
let html="";
[1,3,7,30,90].forEach(x=>{
html+=`<span class="badge ${d>=x?"unlocked":""}">${x}d</span>`;
});
document.getElementById("badges").innerHTML=html;
}

function logMood(){
let mood=document.getElementById("mood").value;
let msg="";
if(mood=="Stressed") msg="Stress triggers cravings. Do 4 deep breaths now.";
if(mood=="Bored") msg="Replace habit with short walk.";
if(mood=="Angry") msg="Pause. Delay reaction 60 seconds.";
if(mood=="Social Pressure") msg="You are stronger than social approval.";
if(mood=="Calm") msg="Good. Protect this state.";
document.getElementById("coachMessage").innerText=msg;
}

function startSurvival(){
stage=1;
document.getElementById("survivalBox").classList.remove("hidden");
loadStage();
logCraving();
}

function loadStage(){
let box=document.getElementById("survivalContent");
if(stage==1){
box.innerHTML=`<p>Stage 1: 60s Focus</p>`;
let t=60;
let i=setInterval(()=>{
box.innerHTML=`Stay Strong: ${t}`;
t--;
if(t<=0){clearInterval(i);stage++;loadStage();}
},1000);
}
if(stage==2){
box.innerHTML=`<p>Cravings last?</p>
<button onclick="answer(1)">3-10 min</button>
<button onclick="answer(0)">1 hour</button>`;
}
if(stage==3){
box.innerHTML=`<p>Craving Defeated.</p>`;
setTimeout(()=>{document.getElementById("survivalBox").classList.add("hidden");},2000);
}
}

function answer(x){if(x==1){stage++;loadStage();}else alert("Wrong.");}

function logCraving(){
let logs=JSON.parse(localStorage.getItem("cravingLog")||"[]");
logs.push(Date.now());
localStorage.setItem("cravingLog",JSON.stringify(logs));
}

function detectPattern(){
let logs=JSON.parse(localStorage.getItem("cravingLog")||"[]");
let hours={};
logs.forEach(t=>{
let h=new Date(t).getHours();
hours[h]=(hours[h]||0)+1;
});
let risky=Object.keys(hours).find(h=>hours[h]>=3);
if(risky){
document.getElementById("patternMsg").innerText=
"You often crave around "+risky+":00. Prepare mentally.";
}
}

function resetApp(){localStorage.clear();location.reload();}

window.onload=()=>{
if(localStorage.getItem("quitData")){
document.getElementById("setup").classList.add("hidden");
document.getElementById("dashboard").classList.remove("hidden");
updateEngine();
setInterval(updateEngine,1000);
}
}
</script>

</body>
</html>
